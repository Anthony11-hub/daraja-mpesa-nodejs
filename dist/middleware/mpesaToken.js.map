{"version":3,"file":"mpesaToken.js","sourceRoot":"/","sources":["middleware/mpesaToken.ts"],"names":[],"mappings":";;;;;;AAAA,kDAA0B;AAE1B,kDAA8C;AAEvC,MAAM,kBAAkB,GAAmB,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,EAAE;IACzE,IAAI,CAAC;QACH,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC;QAC3C,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,qBAAqB,CAAC;QAEjD,MAAM,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC,GAAG,GAAG,IAAI,MAAM,EAAE,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;QAEhE,MAAM,MAAM,GAAG;YACb,OAAO,EAAE;gBACP,MAAM,EAAE,kBAAkB;gBAC1B,aAAa,EAAE,SAAS,IAAI,EAAE;aAC/B;SACF,CAAC;QAEF,MAAM,QAAQ,GAAG,MAAM,eAAK,CAAC,GAAG,CAC9B,6EAA6E,EAC7E,MAAM,CACP,CAAC;QAEF,MAAM,KAAK,GAAG,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC;QAEzC,GAAG,CAAC,KAAK,GAAG,KAAK,CAAC;QAElB,IAAI,EAAE,CAAC;IACT,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,MAAM,IAAI,oBAAQ,CAChB,uBAAuB,EACvB,iDAAiD,KAAK,EAAE,EACxD,GAAG,CACJ,CAAC;IACJ,CAAC;AACH,CAAC,CAAC;AA/BW,QAAA,kBAAkB,sBA+B7B","sourcesContent":["import axios from \"axios\";\nimport { RequestHandler } from \"express\";\nimport { AppError } from \"../error/app.error\";\n\nexport const generateMpesaToken: RequestHandler = async (req, res, next) => {\n  try {\n    const key = process.env.MPESA_CONSUMER_KEY;\n    const secret = process.env.MPESA_CONSUMER_SECRET;\n\n    const auth = Buffer.from(`${key}:${secret}`).toString(\"base64\");\n\n    const config = {\n      headers: {\n        Accept: \"application/json\",\n        Authorization: `Basic ${auth}`,\n      },\n    };\n\n    const response = await axios.get(\n      \"https://api.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials\",\n      config,\n    );\n\n    const token = response.data.access_token;\n\n    req.token = token;\n\n    next();\n  } catch (error) {\n    throw new AppError(\n      \"Internal server error\",\n      `An error occurred while generating the token: ${error}`,\n      500,\n    );\n  }\n};\n"]}