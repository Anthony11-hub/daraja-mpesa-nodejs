{"version":3,"file":"error-handler.js","sourceRoot":"/","sources":["middleware/error-handler.ts"],"names":[],"mappings":";;;AAAA,uDAAoD;AAEpD,kDAA8C;AAC9C,gEAA4D;AAC5D,oCAAiC;AAEjC,MAAM,QAAQ,GAAG,CAAC,KAAY,EAAE,GAAY,EAAE,IAAY,EAAE,EAAE;IAC5D,aAAK,CAAC,MAAM,CAAC,KAAK,CAAC;QACjB,KAAK,EAAE,OAAO;QACd,OAAO,EAAE,GAAG,IAAI,WACd,KAAK,YAAY,oBAAQ,IAAI,KAAK,YAAY,kCAAe;YAC3D,CAAC,CAAC,KAAK,CAAC,QAAQ;YAChB,CAAC,CAAC,KAAK,CAAC,OACZ,EAAE;QACF,OAAO,EAAE;YACP,KAAK,EAAE,GAAG,CAAC,WAAW;YACtB,MAAM,EAAE,GAAG,CAAC,MAAM;YAClB,IAAI,EAAE,GAAG,CAAC,IAAI;SACf;KACF,CAAC,CAAC;AACL,CAAC,CAAC;AAEK,MAAM,YAAY,GAAG,CAC1B,KAAY,EACZ,GAAY,EACZ,GAAa,EACb,IAAkB,EAClB,EAAE;IACF,IAAI,KAAK,YAAY,kCAAe,EAAE,CAAC;QACrC,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE,YAAY,CAAC,CAAC;QACnC,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;IAC1D,CAAC;IAED,IAAI,KAAK,YAAY,oBAAQ,EAAE,CAAC;QAC9B,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE,KAAK,CAAC,CAAC;QAC5B,OAAO,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,KAAK,CAAC,OAAO,EAAE,CAAC,CAAC;IACvE,CAAC;IAED,IAAI,KAAK,YAAY,eAAM,CAAC,6BAA6B,EAAE,CAAC;QAC1D,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;QAE/B,IAAI,YAAY,CAAC;QACjB,QAAQ,KAAK,CAAC,IAAI,EAAE,CAAC;YACnB,KAAK,OAAO,EAAE,8BAA8B;gBAC1C,YAAY,GAAG,gDAAgD,CAAC;gBAChE,MAAM;YACR,KAAK,OAAO,EAAE,mBAAmB;gBAC/B,YAAY,GAAG,0CAA0C,CAAC;gBAC1D,MAAM;YACR;gBACE,YAAY,GAAG,wCAAwC,CAAC;gBACxD,MAAM;QACV,CAAC;QAED,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,EAAE,OAAO,EAAE,YAAY,EAAE,CAAC,CAAC;IACzD,CAAC;IAED,8BAA8B;IAC9B,QAAQ,CAAC,KAAK,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC;IAChC,OAAO,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QAC1B,OAAO,EAAE,uBAAuB;KACjC,CAAC,CAAC;AACL,CAAC,CAAC;AAxCW,QAAA,YAAY,gBAwCvB","sourcesContent":["import { Prisma } from \"../generated/prisma/client\";\nimport { Request, Response, NextFunction } from \"express\";\nimport { AppError } from \"../error/app.error\";\nimport { ValidationError } from \"../error/validation.error\";\nimport { utils } from \"../utils\";\n\nconst logError = (error: Error, req: Request, type: string) => {\n  utils.logger.error({\n    level: \"error\",\n    message: `${type} Error: ${\n      error instanceof AppError || error instanceof ValidationError\n        ? error.errorLog\n        : error.message\n    }`,\n    context: {\n      route: req.originalUrl,\n      method: req.method,\n      body: req.body,\n    },\n  });\n};\n\nexport const errorHandler = (\n  error: Error,\n  req: Request,\n  res: Response,\n  next: NextFunction,\n) => {\n  if (error instanceof ValidationError) {\n    logError(error, req, \"Validation\");\n    return res.status(400).json({ message: error.message });\n  }\n\n  if (error instanceof AppError) {\n    logError(error, req, \"App\");\n    return res.status(error.statusCode).json({ message: error.message });\n  }\n\n  if (error instanceof Prisma.PrismaClientKnownRequestError) {\n    logError(error, req, \"Prisma\");\n\n    let errorMessage;\n    switch (error.code) {\n      case \"P2002\": // Unique constraint violation\n        errorMessage = \"A record with this information already exists.\";\n        break;\n      case \"P2025\": // Record not found\n        errorMessage = \"The requested record could not be found.\";\n        break;\n      default:\n        errorMessage = \"An unexpected database error occurred.\";\n        break;\n    }\n\n    return res.status(409).json({ message: errorMessage });\n  }\n\n  // handle unknown errorMessage\n  logError(error, req, \"Unknown\");\n  return res.status(500).json({\n    message: \"Internal server error\",\n  });\n};\n"]}